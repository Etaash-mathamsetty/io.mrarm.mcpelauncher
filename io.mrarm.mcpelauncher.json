{
    "id": "io.mrarm.mcpelauncher",
    "runtime": "org.kde.Platform",
    "runtime-version": "5.15",
    "sdk": "org.kde.Sdk",
    "base": "io.qt.qtwebengine.BaseApp",
    "base-version": "5.15",
    "command": "mcpelauncher-ui-qt",
    "cleanup": [
        "*.a",
        "*.la",
        "/bin/protoc",
        "/bin/zipcmp",
        "/bin/zipmerge",
        "/bin/ziptool",
        "/bin/captoinfo",
        "/bin/clear",
        "/bin/infocmp",
        "/bin/ncursesw5-config",
        "/bin/reset",
        "/bin/tabs",
        "/bin/tic",
        "/bin/toe",
        "/bin/tput",
        "/bin/tset",
        "/bin/infotocap",
        "/lib/libprotobuf-lite*",
        "/lib/libprotoc*",
        "/lib/libform*",
        "/lib/libncurses*",
        "/lib/libpanel*",
        "/lib/libformw*",
        "/lib/libtinfo.so.5",
        "/lib/terminfo",
        "/lib/libmenu*"
    ],
    "cleanup-commands": [
        "/app/cleanup-BaseApp.sh"
    ],
    "finish-args": [
        "--socket=x11",
        "--share=network",
        "--device=dri",
        "--socket=pulseaudio",
        "--device=all"
    ],
    "add-build-extensions": {
        "org.freedesktop.Sdk.Extension.toolchain-i386": {
            "directory": "lib/sdk/toolchain-i386",
            "remove-after-build": true,
            "version": "20.08"
        },
        "org.freedesktop.Sdk.Extension.toolchain-arm": {
            "directory": "lib/sdk/toolchain-arm",
            "remove-after-build": true,
            "version": "19.08"
        }
    },
    "add-extensions": {
        "org.freedesktop.Platform.Compat.i386": {
            "directory": "lib/i386-linux-gnu",
            "version": "20.08"
        },
        "org.freedesktop.Platform.Compat.arm": {
            "directory": "lib/arm-linux-gnueabihf",
            "version": "19.08"
        }
    },
    "modules": [
        {
            "name": "aarch64-multlib-workaround",
            "buildsystem": "simple",
            "build-commands": [
                "ARCHIVE=$PWD/arm-linux-gnueabihf.tar.xz mkdir -p /app/lib/sdk/ && cd /app/lib/sdk/ && tar -xf --no-same-owner $ARCHIVE"
            ],
            "only-arches": ["aarch64"],
            "sources": [
                {
                    "type": "file",
                    "url": "https://github.com/flathub/io.mrarm.mcpelauncher/releases/download/0.0.5-multiarchsupport/arm-linux-gnueabihf.tar.xz",
                    "sha512": "ec17d1c7d473823a228668e00fc9118f5ab13d7396ee53df03fe0a0791af2dd0f0fc61e9f2fe0882b4a3ca29c7b09257e0e17c03560bb7211f0dbca0ef4e0396"
                }
            ]
        },
        {
            "name": "x86_64-multlib-workaround",
            "buildsystem": "simple",
            "build-commands": [
                "ARCHIVE=$PWD/i386-linux-gnu.tar.xz mkdir -p /app/lib/sdk/ && cd /app/lib/sdk/ && tar -xf --no-same-owner $ARCHIVE",
                "ARCHIVE=$PWD/toolchain-i386.tar.xz mkdir -p /app/lib/sdk/ && cd /app/lib/sdk/ && tar -xf --no-same-owner $ARCHIVE"
            ],
            "only-arches": ["x86_64"],
            "sources": [
                {
                    "type": "file",
                    "url": "https://github.com/flathub/io.mrarm.mcpelauncher/releases/download/0.0.5-multiarchsupport/i386-linux-gnu.tar.xz",
                    "sha512": "11e11ebe9a1a33d006b9c41259ef99e964c09c3db7b7c8234716923b708499ae5b19cab063f356afa1359023954650f4ceea2743ab6ae7a4f6db31de78082c1c"
                },
                {
                    "type": "file",
                    "url": "https://github.com/flathub/io.mrarm.mcpelauncher/releases/download/0.0.5-multiarchsupport/toolchain-i386.tar.xz",
                    "sha512": "db0241645d3247b70c9b1cd4f61a7f0f9334e0c2728b9373891cc9e25b9141ebfe14d61e0abdc2d615a121bedef9d2f8df3df9612a93286efe19c34a1e994c11"
                }
            ]
        },
        {
            "name": "mcpelauncher-client32",
            "buildsystem": "cmake",
            "build-options" : {
                "arch": {
                    "x86_64": {
                        "cflags": "-DNDEBUG -m32 -I/usr/include -L/app/lib/i386-linux-gnu -L/app/lib/sdk/i386-linux-gnu -fuse-ld=lld -nostdlib -I/app/lib/sdk/i386-linux-gnu/include",
                        "cxxflags": "-DNDEBUG -m32  -L/app/lib/i386-linux-gnu -L/app/lib/sdk/i386-linux-gnu -fuse-ld=lld -nostdlib -I/app/lib/sdk/i386-linux-gnu/include -I/app/lib/sdk/toolchain-i386/i686-unknown-linux-gnu/include/c++/10.2.0/ -I/app/lib/sdk/toolchain-i386/i686-unknown-linux-gnu/include/c++/10.2.0/i686-unknown-linux-gnu",
                        "prepend-pkg-config-path": "/app/lib/sdk/i386-linux-gnu/pkgconfig:/app/lib/i386-linux-gnu/pkgconfig",
                        "config-opts": [ "-DZLIB_LIBRARY=/app/lib/sdk/i386-linux-gnu/libz.so", "-DPNG_LIBRARY=/app/lib/sdk/i386-linux-gnu/libpng.so -DPNG_PNG_INCLUDE_DIR=/usr/include/libpng -DX11_X11_LIB=/app/lib/sdk/i386-linux-gnu/libX11.so", "-DCURL_LIBRARY=/app/lib/sdk/i386-linux-gnu/libcurl.so", "-DOPENSSL_INCLUDE_DIR=/app/lib/sdk/i386-linux-gnu/include", "-DOPENSSL_SSL_LIBRARY=/app/lib/sdk/i386-linux-gnu/libcrypto.so", "-DOPENSSL_CRYPTO_LIBRARY=/app/lib/sdk/i386-linux-gnu/libcrypto.so", "-DPULSEAUDIO_LIBRARIES=/app/lib/sdk/i386-linux-gnu/libpulse.so", "-DPULSEAUDIOSIMPLE_LIBRARIES=/app/lib/sdk/i386-linux-gnu/libpulse-simple.so" ]
                    },
                    "aarch64": {
                        "cflags": "-DNDEBUG -m32 -I/usr/include -L/app/lib/arm-linux-gnueabihf -L/app/lib/sdk/arm-linux-gnueabihf -fuse-ld=lld -nostdlib -I/app/lib/sdk/arm-linux-gnueabihf/include",
                        "cxxflags": "-DNDEBUG -m32  -L/app/lib/arm-linux-gnueabihf -L/app/lib/sdk/arm-linux-gnueabihf -fuse-ld=lld -nostdlib -I/app/lib/sdk/arm-linux-gnueabihf/include -I/app/lib/sdk/toolchain-arm/arm-unknown-linux-gnueabihf/include/c++/9.3.0/ -I/app/lib/sdk/toolchain-arm/arm-unknown-linux-gnueabihf/include/c++/9.3.0/arm-unknown-linux-gnueabihf",
                        "prepend-pkg-config-path": "/app/lib/sdk/arm-linux-gnueabihf/pkgconfig:/app/lib/arm-linux-gnueabihf/pkgconfig",
                        "config-opts": [ "-DZLIB_LIBRARY=/app/lib/sdk/arm-linux-gnueabihf/libz.so", "-DPNG_LIBRARY=/app/lib/sdk/arm-linux-gnueabihf/libpng.so -DPNG_PNG_INCLUDE_DIR=/usr/include/libpng -DX11_X11_LIB=/app/lib/sdk/arm-linux-gnueabihf/libX11.so", "-DCURL_LIBRARY=/app/lib/sdk/arm-linux-gnueabihf/libcurl.so", "-DOPENSSL_INCLUDE_DIR=/app/lib/sdk/arm-linux-gnueabihf/include", "-DOPENSSL_SSL_LIBRARY=/app/lib/sdk/arm-linux-gnueabihf/libcrypto.so", "-DOPENSSL_CRYPTO_LIBRARY=/app/lib/sdk/arm-linux-gnueabihf/libcrypto.so", "-DPULSEAUDIO_LIBRARIES=/app/lib/sdk/arm-linux-gnueabihf/libpulse.so", "-DPULSEAUDIOSIMPLE_LIBRARIES=/app/lib/sdk/arm-linux-gnueabihf/libpulse-simple.so" ]
                    }
                },
                "env": {
                    "CC": "clang",
                    "CXX": "clang++"
                },
                "config-opts": [ "-DGAMEWINDOW_SYSTEM=GLFW", "-DENABLE_DEV_PATHS=OFF", "-DBUILD_FAKE_JNI_TESTS=OFF", "-DBUILD_FAKE_JNI_EXAMPLES=OFF", "-DBUILD_BARON_EXAMPLES=OFF", "-DFETCHCONTENT_SOURCE_DIR_NLOHMANN_JSON_EXT=nlohmann_json_ext", "-DFETCHCONTENT_SOURCE_DIR_GLFW3_EXT=glfw3_ext", "-DBUILD_WEBVIEW=OFF", "-DCMAKE_CXX_COMPILER_TARGET=i686-linux-gnu" ]
            },
            "only-arches": [ "x86_64", "aarch64" ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/minecraft-linux/mcpelauncher-manifest.git",
                    "commit": "775225d230b666315b0fd40d0b347c1dfdf3f8ab"
                },
                {
                    "type": "file",
                    "url": "https://github.com/minecraft-linux/glfw/archive/37204ede828296f8b6fe068851f3c7841bf20161.zip",
                    "sha512": "dcc083cd5b805d41fc7b4c59187977cd8e2f45dffcc35c47579170ec2433df66b91ba603eebef3f994c02058869b0bbb1aa18d79f61e66f3d83cbe6201fb29bc",
                    "dest-filename": "glfw3_ext.zip"
                },
                {
                    "type": "shell",
                    "commands": [
                        "mkdir glfw3_ext",
                        "cd glfw3_ext && unzip ../glfw3_ext.zip",
                        "mv glfw3_ext/*/* glfw3_ext/"
                    ]
                },
                {
                    "type": "file",
                    "url": "https://github.com/nlohmann/json/releases/download/v3.7.3/include.zip",
                    "sha512": "8efd82a54472335e548d0d5c375b6f2781b4a0f2dbc5aa0acc3f504277ec455e0782046286cf08eb4864ac8bcaa1a9691af8d0259dd71a9e539cfc12e0478eb5",
                    "dest-filename": "nlohmann_json_ext.zip"
                },
                {
                    "type": "shell",
                    "commands": [
                        "mkdir nlohmann_json_ext",
                        "cd nlohmann_json_ext && unzip ../nlohmann_json_ext.zip"
                    ]
                }
            ]
        },
        {
            "name": "compat",
            "buildsystem": "simple",
            "build-commands": [
                "install -Dm644 io.mrarm.mcpelauncher.desktop /app/share/applications/io.mrarm.mcpelauncher.desktop",
                "install -Dm644 mcpelauncher-icon.svg /app/share/icons/hicolor/scalable/apps/io.mrarm.mcpelauncher.svg",
                "install -Dm644 io.mrarm.mcpelauncher.metainfo.xml /app/share/metainfo/io.mrarm.mcpelauncher.metainfo.xml"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/minecraft-linux/mcpelauncher-proprietary.git",
                    "commit": "f532839395ee2935f635ea9d356439bcf3b3ab2f"
                },
                {
                    "type": "file",
                    "path": "io.mrarm.mcpelauncher.metainfo.xml"
                },
                {
                    "type": "file",
                    "path": "io.mrarm.mcpelauncher.desktop"
                }
            ]
        }
    ]
}
