{
    "id": "io.mrarm.mcpelauncher",
    "runtime": "org.kde.Platform",
    "runtime-version": "5.15",
    "sdk": "org.kde.Sdk",
    "base": "io.qt.qtwebengine.BaseApp",
    "base-version": "5.15",
    "command": "mcpelauncher-client",
    "cleanup": [
        "*.a",
        "*.la",
        "/bin/protoc",
        "/bin/zipcmp",
        "/bin/zipmerge",
        "/bin/ziptool",
        "/bin/captoinfo",
        "/bin/clear",
        "/bin/infocmp",
        "/bin/ncursesw5-config",
        "/bin/reset",
        "/bin/tabs",
        "/bin/tic",
        "/bin/toe",
        "/bin/tput",
        "/bin/tset",
        "/bin/infotocap",
        "/lib/libprotobuf-lite*",
        "/lib/libprotoc*",
        "/lib/libform*",
        "/lib/libncurses*",
        "/lib/libpanel*",
        "/lib/libformw*",
        "/lib/libtinfo.so.5",
        "/lib/terminfo",
        "/lib/libmenu*"
    ],
    "cleanup-commands": [
        "/app/cleanup-BaseApp.sh"
    ],
    "finish-args": [
        "--socket=x11",
        "--share=network",
        "--device=dri",
        "--socket=pulseaudio",
        "--device=all"
    ],
    "add-build-extensions": {
        "org.freedesktop.Sdk.Extension.toolchain-arm": {
            "directory": "lib/toolchain-arm",
            "remove-after-build": true,
            "version": "19.08"
        }
    },
    "add-extensions": {
        "org.freedesktop.Platform.Compat.i386": {
            "directory": "lib/i386-linux-gnu",
            "version": "20.08"
        },
        "org.freedesktop.Platform.Compat.arm": {
            "directory": "lib/arm-linux-gnueabihf",
            "version": "19.08"
        }
    },
    "modules": [
        {
            "name": "aarch64-multlib-workaround",
            "buildsystem": "simple",
            "build-commands": [
                "mkdir -p /app/lib/sdk/ && tar --no-same-owner -xf $PWD/arm-linux-gnueabihf.tar.xz -C /app/lib/sdk/",
                "cd /app/lib && ln -s arm-linux-gnueabihf/ld-linux-armhf.so.3 ld-linux-armhf.so.3",
                "mkdir -p /app/usr/lib && cd /app/usr/lib && ln -s ../../lib/arm-linux-gnueabihf/ arm-linux-gnueabihf",
                "mkdir -p /app/usr && cd /app/usr && ln -s /usr/include/ include"
            ],
            "only-arches": ["aarch64"],
            "sources": [
                {
                    "type": "file",
                    "url": "https://github.com/flathub/io.mrarm.mcpelauncher/releases/download/0.0.5-multiarchsupport/arm-linux-gnueabihf.tar.xz",
                    "sha512": "95cfe3c6357ecfc409a8d6bd5d7e12aac146748c76bac94f830b80b96240a6d76da3d8c30816bfa6f38565bfd06238a9177bc221df3b44587ec2cc36b71a3afc"
                }
            ]
        },
        {
            "name": "aarch64-multlib-workaround-clang",
            "buildsystem": "cmake",
            "only-arches": ["aarch64"],
            "build-options" : {
                "config-opts": [ "-DCMAKE_BUILD_TYPE=Release", "-DLLVM_TARGETS_TO_BUILD=X86;AArch64;ARM", "-DLLVM_ENABLE_PROJECTS=clang;lld", "-DLLVM_BUILD_TOOLS=True", "-DLLVM_INCLUDE_TOOLS=True", "-DLLVM_INCLUDE_EXAMPLES=True", "-DLLVM_INCLUDE_TESTS=True" ]
            },
            "subdir": "llvm",
            "builddir": true,
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/llvm/llvm-project.git",
                    "commit": "b59b6b662bb987955f1516c9a47e96c7ab443ac6"
                }
            ]
        },
        {
            "name": "x86_64-multlib-workaround",
            "buildsystem": "simple",
            "build-commands": [
                "mkdir -p /app/lib/ && tar --no-same-owner -xf $PWD/i386-linux-gnu.tar.xz -C /app/lib",
                "mkdir -p /app/lib/ && tar --no-same-owner -xf $PWD/toolchain-i386.tar.xz -C /app/lib",
                "cd /app/lib && ln -s i386-linux-gnu/ld-linux.so.2 ld-linux.so.2",
                "mkdir -p /app/usr/lib && cd /app/usr/lib && ln -s ../../lib/i386-linux-gnu/ i386-linux-gnu",
                "mkdir -p /app/usr && cd /app/usr && ln -s /usr/include/ include"
            ],
            "only-arches": ["x86_64"],
            "sources": [
                {
                    "type": "file",
                    "url": "https://github.com/flathub/io.mrarm.mcpelauncher/releases/download/0.0.5-multiarchsupport/i386-linux-gnu.tar.xz",
                    "sha512": "11e11ebe9a1a33d006b9c41259ef99e964c09c3db7b7c8234716923b708499ae5b19cab063f356afa1359023954650f4ceea2743ab6ae7a4f6db31de78082c1c"
                },
                {
                    "type": "file",
                    "url": "https://github.com/flathub/io.mrarm.mcpelauncher/releases/download/0.0.5-multiarchsupport/toolchain-i386.tar.xz",
                    "sha512": "db0241645d3247b70c9b1cd4f61a7f0f9334e0c2728b9373891cc9e25b9141ebfe14d61e0abdc2d615a121bedef9d2f8df3df9612a93286efe19c34a1e994c11"
                }
            ]
        },
        {
            "name": "mcpelauncher-client32",
            "buildsystem": "cmake",
            "build-options" : {
                "arch": {
                    "x86_64": {
                        "cflags": "-DNDEBUG --target=i686-unknown-linux-gnu --sysroot=/app -gcc-toolchain /app/lib/toolchain-i386/ -I/app/lib/i386-linux-gnu/include/",
                        "cxxflags": "-DNDEBUG --target=i686-unknown-linux-gnu --sysroot=/app -gcc-toolchain /app/lib/toolchain-i386/ -I/app/lib/i386-linux-gnu/include/",
                        "prepend-pkg-config-path": "/app/lib/i386-linux-gnu/pkgconfig:/app/lib/i386-linux-gnu/pkgconfig",
                        "prepend-ld-library-path": "/app/lib/i386-linux-gnu:",
                        "ldflags": "-L/app/lib/i386-linux-gnu -v"
                    },
                    "aarch64": {
                        "prepend-path": "/app/bin",
                        "cflags": "-DNDEBUG --target=arm-unknown-linux-gnueabihf -march=armv7 -mfpu=neon --sysroot=/app -gcc-toolchain /app/lib/toolchain-arm/ -I/app/lib/arm-linux-gnueabihf/include",
                        "cflags-override": true,
                        "cxxflags": "-DNDEBUG --target=arm-unknown-linux-gnueabihf -march=armv7 -mfpu=neon --sysroot=/app -gcc-toolchain /app/lib/toolchain-arm/ -I/app/lib/arm-linux-gnueabihf/include",
                        "cxxflags-override": true,
                        "prepend-pkg-config-path": "/app/lib/sdk/arm-linux-gnueabihf/pkgconfig:/app/lib/arm-linux-gnueabihf/pkgconfig",
                        "prepend-ld-library-path": "/app/lib/arm-linux-gnueabihf:",
                        "ldflags": "-L/app/lib/arm-linux-gnueabihf -v"
                    }
                },
                "env": {
                    "CC": "clang",
                    "CXX": "clang++"
                },
                "config-opts": [ "-DGAMEWINDOW_SYSTEM=GLFW", "-DENABLE_DEV_PATHS=OFF", "-DBUILD_FAKE_JNI_TESTS=OFF", "-DBUILD_FAKE_JNI_EXAMPLES=OFF", "-DBUILD_BARON_EXAMPLES=OFF", "-DFETCHCONTENT_SOURCE_DIR_NLOHMANN_JSON_EXT=nlohmann_json_ext", "-DFETCHCONTENT_SOURCE_DIR_GLFW3_EXT=glfw3_ext", "-DBUILD_WEBVIEW=OFF", "-DCMAKE_CXX_COMPILER_TARGET=i686-linux-gnu" ]
            },
            "only-arches": [ "x86_64", "aarch64" ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/minecraft-linux/mcpelauncher-manifest.git",
                    "commit": "775225d230b666315b0fd40d0b347c1dfdf3f8ab"
                },
                {
                    "type": "file",
                    "url": "https://github.com/minecraft-linux/glfw/archive/37204ede828296f8b6fe068851f3c7841bf20161.zip",
                    "sha512": "dcc083cd5b805d41fc7b4c59187977cd8e2f45dffcc35c47579170ec2433df66b91ba603eebef3f994c02058869b0bbb1aa18d79f61e66f3d83cbe6201fb29bc",
                    "dest-filename": "glfw3_ext.zip"
                },
                {
                    "type": "shell",
                    "commands": [
                        "mkdir glfw3_ext",
                        "cd glfw3_ext && unzip ../glfw3_ext.zip",
                        "mv glfw3_ext/*/* glfw3_ext/"
                    ]
                },
                {
                    "type": "file",
                    "url": "https://github.com/nlohmann/json/releases/download/v3.7.3/include.zip",
                    "sha512": "8efd82a54472335e548d0d5c375b6f2781b4a0f2dbc5aa0acc3f504277ec455e0782046286cf08eb4864ac8bcaa1a9691af8d0259dd71a9e539cfc12e0478eb5",
                    "dest-filename": "nlohmann_json_ext.zip"
                },
                {
                    "type": "shell",
                    "commands": [
                        "mkdir nlohmann_json_ext",
                        "cd nlohmann_json_ext && unzip ../nlohmann_json_ext.zip"
                    ]
                }
            ]
        }
    ]
}
